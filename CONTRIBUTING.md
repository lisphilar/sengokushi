# 条件イベント

## 代数

### 定数、値固定のリスト

- `NA`: 該当する大名家がないことを示す大名番号、家名変更後に%大名NA%にて「NA」など表示可能
- `Chotei`: 朝廷の大名番号
- `Toyomtomi`: 豊臣氏宗家の大名番号
- `Tokugawa`: 徳川家の大名番号
- `NAB`: 該当する武将がいないことを示す武将番号、武将名変更後に%大名NA%にて「NA」など表示可能
- `TRUE`: Flag用、1
- `FALSE`: Flag用、0
- `StartYear`: シナリオ開始年
- `StartMonth`: シナリオ開始月
- `Player`: プレーヤー大名の番号
- `Observer`: 観戦時のプレーヤー番号
- `DTotalN`: 大名家の総数
- `STotalN`: 城の総数
- `CTotalN`: 国・地域の総数
- `SForRouninN`: 牢人家の最大数（=牢人用の拠点の数）

### 色

- `WHITE`, `RED`, `BLACKRED`, `BLUE`, `GREEN`, `YELLOW`, `BLACK`: 各色のコードを示す武将番号
- メッセージの一部の色を変更したい場合："%武将RED%赤色の箇所%武将BLACK%"
- 一部文字列を消したい場合：if... Color=WHITE, else Color=BLACK, "%武将color%条件に応じて%武将BLACK"

### イベント呼び出し不要で使用可能なリスト

- `SRegionList[城番号]`：各城の所属する地方名の城番号（代入後「%城Region%」の形にて表示可能）
- `SCountryList[城番号]`：各城の所属する国名の城番号（代入後「%城Country%」の形にて表示可能）
- `CNameList[カウント]`：国名の城番号（0 $\leq$ カウント $\leq$ `CTotalN`）
- `SForRouninFList[城番号]`：
  - `TRUE`：牢人家用の拠点（朝廷自身又は初期外交にて朝廷に従属する家の拠点、京都御所を除く）
    - 牢人家用の拠点数を増やす場合はCE_0125のメッセージへの1行追加も必要
  - `FALSE`：牢人家以外用の拠点
- `DStatusList[大名番号]`：家格一覧
  - `自身の大名番号*Kougi`：公儀, 返り値 $\geq$ `Kougi`
  - `自身の大名番号`：一般大名家, 0 $<$ 返り値 $<$ `Kougi`
  - `自身の大名番号*Others`(=0)：滅亡済の家や朝廷、シナリオ進行用の家
  - `一般大名家の大名番号*Kashin`：家臣, `Rounin` $<$ 返り値 $<$ 0
  - `自身の大名番号*Rounin`：牢人家, 返り値 $<$ `Rounin`
- `SyukeList[大名番号]`：現在の主家（従属・臣従先の独立大名家）
- `DKashinNList[大名番号]`：各一般大名家の現在の家臣数

### 初期設定

- 初期外交：家臣の初期設定を変更したい場合は臣従とする
- CE_0063, CE_0064: 初期外交にて豊臣氏宗家・徳川家に従属する大名家を設定している
- CE_0003, CE_0034: シナリオ進行用の家の設定

## 汎用イベント

- CE_0157: 石高を「%a%万%b%%c%%d%%e%石」の形式に変換する。
  - 引数`Value`: 石高の数値
  - 返り値`a`: 1万以上, `b`: 千の位, `c`: 百の位, `d`: 十の位, `e`: 一の位
- CE_0282: 拠点を提供したことによる家石高の変化を万石単位で計算する
  - 引数`Value`: 提供した拠点の石高
  - 引数`Provider`: 提供側の家の大名番号
  - 引数`Receiver`: 受領側の家の大名番号
  - 返り値：メッセージ上で以下の通り表記できる
    - "%大名Provider%：%ProviderOldMU%万石→%ProviderNewMU%万石"
    - "%大名Receiver%：%ReceiverOldMU%万石→%ReceiverNewMU%万石"
- CE_0158: 数値をカンマ付で表示できるように変換する。
  - 引数`Value`: 経済の数値
  - 返り値：メッセージ上で以下の通り表記できる
    - "経済：%a%%武将b%%武将c%%武将d%%武将e%"
    - 例：2100 $\to$ 2,100
    - 例：320 $\to$ 320
- CE_0215: 大名家の借金算出
  - 引数`Target`: 大名家の番号
  - 返り値`Debt`: 借金の額
- CE_0358: 配列の値が降順となるようにインデックスを並び替える
  - 引数`TargetL[インデックス]`: 各インデックス（1以上, 大名番号/城番号/武将番号など） に対する値
  - 引数`IgnoredValue`: ランク外として扱う値
  - 引数`IgnoredForIgnored`: インデックスに対する値が`IgnoredValue`に一致した場合の`RankL[順位]`の値
  - 引数`Length`: インデックス（1以上）の数、`DTotalN`, `STotalN`, 直属武将数など
  - 返り値`RankL[順位]`: 各順位（1以上）に該当するインデックス

### 地方、国、城

#### 情報取得、操作、一覧表示

- CE_0110: 地方・国名の一覧表示
- CE_0082: 特定の城にいる武将をすべて移動させる
  - 引数`SBefore`: 移動前の城、`SAfter`: 移動後の城
- CE_0183: 所在地や領主、石高、経済など城の情報を計算
  - 引数`Target`: 城番号
  - 返り値`KokudakaCurrent`: 現在の石高
  - 返り値`KokudakaMax`: 最大石高
  - 返り値`EconomyCurrent`: 現在の町経済
  - 返り値`EconomyMax`: 最大町経済
- CE_0153: 所在地や領主、石高、経済など城の情報をメッセージにて表示する
  - 引数`CountrySelected`: 国の城番号（`ShiroSelected`を含めた両方が`NA`の場合はプレーヤーが選択する）
  - 引数`ShiroSelected`: 国又は拠点の城番号（`NA`の場合はプレーヤーが選択する）
  - 返り値`KokudakaCurrent`: 現在の石高
  - 返り値`KokudakaMax`: 最大石高
  - 返り値`EconomyCurrent`: 現在の町経済
  - 返り値`EconomyMax`: 最大町経済
- CE_0319: 特定の城について、史実上・石高上・城数上、現城主が新城主に手放すことを受け入れられるかどうかを評価する
  - 引数`ShiroTentative`: 検討を行う拠点の城番号
  - 引数`Receiver`: 新城主
  - 返り値`ShiroAprroved`: 受け入れられる場合は`ShiroTentative`と同値、不可の場合は`NA`
    - 城の領主（直轄）がプレーヤーである場合は、史実上及び石高上の妥当性は検討しない

#### プレーヤーによる選択

- CE_0135: 特定の家との関係に基づいて、プレーヤーが城を選択する
  - 引数`Syuka`, `Filter`:
    - `Filter=0`: `Syuka`とは異なる独立家に直接・間接的に専有されている城から選ぶ場合
    - `Filter=1`: `Syuka`直轄の拠点から選択する場合
    - `Filter=2`: `Syuka`の従属・臣従する一般大名家、または家臣の城から選択する場合
  - 引数`CountrySelectable`: 国内全域も選択可能とする場合は`TRUE`, 選択不可の場合は`FALSE`
  - 返り値`SSelectedL[城番号]`: `TRUE`（選択された）または`FALSE`（選択されなかった）
    - 摂津>大坂城が`TRUE`場合は、直轄領主が大坂城主と同じ大坂町内の拠点についても`TRUE`とする
- CE_0001: プレーヤーが国を指定する
  - 返り値`CountrySelected`: 国の城番号
- CE_0105: プレーヤーが指定した国内に直轄拠点を持つ大名家の特定
  - 返り値`DShiroNCountryList[大名番号]`: 各大名家の、指定した国内にある直轄拠点の数

### 家

- CE_0020: 公儀の一覧
- CE_0155: 特定の家との関係性を一覧化する
  - 引数`Target`: 関係性を評価する家の大名番号
  - 返り値`DRelationL[大名番号]`: 各家の区分
    - `DRelationL[大名番号]=OtherGroup=0`: `Target`自身や配下ではない
    - `DRelationL[大名番号]=Touke`: `Target`自身
    - `DRelationL[大名番号]=JyuzokuDaimyou`: `Target`に従属する一般大名家
    - `DRelationL[大名番号]=ShinjyuDaimyou`: `Target`に臣従する一般大名家
    - `DRelationL[大名番号]=Kashinke`: `Target`の家臣
  - 返り値：`JyuzokuN`: `Target`に従属する一般大名家の数
  - 返り値：`ShinjyuN`: `Target`に臣従する一般大名家の数
  - 返り値：`KashinN`: `Target`の家臣の数
- CE_0067: 家情報のメッセージ表示（一般大名家、家臣、牢人の区分によってテンプレートは異なる）
  - 引数`Target`: 対象となる家の番号
- CE_0305: プレーヤーが、生存独立大名家（プレーヤーの主家を除く）を選択する
  - 返り値`DIndipendent`：選択された生存独立大名家の大名番号
- CE_0133: 主家（プレーヤーを除く）検索後、従属家・臣従家（家臣以外）・家臣をプレーヤーが選択
  - 返り値`DaimyouDetermined`: 選択された家の大名番号
- CE_0134: 特定の主家について、従属家・臣従家（家臣以外）・家臣をプレーヤーが選択
  - 引数`SyukeDetermined`: 主家の大名番号
  - 返り値`DaimyouDetermined`: 選択された家の大名番号
- CE_0051: 特定の独立大名家に対して包囲網形成（孤立）
  - 引数`DaimyouA`: 孤立する特定大名家の大名番号
- CE_0052: すべての独立大名家が非公儀の独立大名家に従属

## 論功行賞

### 加増、加増の約束

- CE_0142: 特定の大名家が配下に対して加増を実施する
  - 引数`Provider`: 直轄拠点を提供する家（主家側）の大名番号（`NA`不可）
  - 引数`Receiver`: 直轄拠点を受領する家（主家側）の大名番号（`NA`の場合はプレーヤーが決定する）
  - 引数`ShiroSpecifiedF`: `TRUE`または`FALSE`
    - `TRUE`の場合: `SSelectedL[城番号]`を作成し渡すことが必要、値が`TRUE`となっている城を提供対象とする
    - `FALSE`の場合: プレーヤーの選択に従って`SSelectedL[城番号]`を作成するため事前作成は不要
- CE_0186: `SSelectedL[城番号]`の初期化
- CE_0187: 特定の大名家が配下に対して加増を**約束**する
  - 引数`Provider`: 直轄拠点を提供する家（主家側）の大名番号（`NA`不可）
  - 引数`Receiver`: 直轄拠点を受領する家（主家側）の大名番号（`NA`の場合はプレーヤーが決定する）
  - 引数`ShiroSpecifiedF`: `TRUE`または`FALSE`
    - `TRUE`の場合: `SSelectedL[城番号]`を作成し渡すことが必要、値が`TRUE`となっている城を提供対象とする
    - `FALSE`の場合: プレーヤーの選択に従って`SSelectedL[城番号]`を作成するため事前作成は不要


### 改易

- CE_0325: 従属・臣従大名・家臣家の改易を実施
  - 引数`Retiree`：改易処分対象の家の大名番号（`NA`の場合はプレーヤーが選択する）
  - 効果：
    - 一般大名家が改易処分を受け入れる場合：出奔
    - 家臣（プレーヤー）が受け入れる場合：出奔
    - 家臣（非プレーヤー）が受け入れる場合：併合
    - 受け入れない場合：独立して主家または盟主との間で宿敵化し、拠点守備兵と兵糧が最大値まで上昇

## 牢人家処遇

- CE_0125: 牢人家の一覧をメッセージにて表示
  - 返り値`DRouninList[カウント]`: 各牢人家の大名番号（0$\leq$大名番号$<$`SForRouninN`）
  - 返り値`SNameForRouninList[カウント]`: 各牢人家の所有する拠点の城番号（0$\leq$大名番号$<$`SForRouninN`）

### 牢人化、出奔

- CE_0297: プレーヤー大名が出奔（牢人化）する
  - 返り値`ShiroExile`: 隠遁先
- CE_0028: 特定の大名家が牢人化する
  - 引数`Retiree`: 牢人となる家の大名番号
  - 引数`ShiroExile`: 隠遁先（`NA`の場合は自動決定）

### 牢人の仕官

- CE_0208: ユーザー（独立大名家）が主家として、選択した牢人家を臣従大名として雇用する
  - 返り値`Employee`: 牢人家の大名番号
  - 返り値`ShiroToPrivide`: 牢人家に提供された、主家の直轄拠点の城番号
- CE_0299: プレーヤーが選択した独立大名家に、当家（牢人家）が臣従大名として仕官する
  - 返り値`Employer`: 仕官先の大名番号
  - 返り値`ShiroToPrivide`: 牢人家に提供された、主家の直轄拠点の城番号
- CE_0274: 特定の独立大名家が主家として、選択した牢人家を臣従大名として雇用する
  - 引数`Employer`: 主家の大名番号
  - 引数`Employee`: 牢人家の大名番号
  - 引数`ShiroToPrivide`: 牢人家に提供される、主家の直轄拠点の城番号



**v1.0.0にあった以下記載のイベントについては、再作成のため一時的にシナリオから削除済。**


#### old: 補助

- 蝦夷・対馬について、石高0の代わりに150名/城/2ヶ月の足軽を追加

#### old: 終了条件

全国制圧：
- 全ての家：天皇家と敵対せず、 通常の城をすべて支配下（直轄・従属・臣従）に置き、京都二条と京都伏見を直轄所有している

公儀統一勝利：
- 徳川・徳川傘下：豊臣が滅亡または豊臣に従属・臣従、京都二条・京都伏見を徳川が所有、他の徳川大名より石高が大きい
- 豊臣・豊臣傘下：徳川が滅亡または豊臣に従属・臣従、京都二条・京都伏見を豊臣が所有、他の豊臣大名より石高が大きい
- その他大名：豊臣氏や徳川家の傘下になく、15年間滅亡しない


#### old: 史実

- 千姫入輿
- 将軍交代
- 武田徳川家の滅亡
- 徳川家から三河韮山内藤家への城引き渡し
- 徳川頼房家の成立
- 大友家滅亡、浅野長政への城提供
- 中村家内紛
- 前田勝茂改易
- 琉球、島津間の戦闘

#### old: 代理家

- 独立大名と従属大名の武将の貸し借り
- 従属大名から貸した武将に兵を追加する
- 勅使派遣
- 国ごと、地方ごとに武将が一つの城に集合する

## 城タイプ

- 標準仕様：天守閣、中国風2件、欧風
- 城の種類：陣屋、平城小、平城大、山砦、岬山城、一般山城、簡易堀城、街中簡易櫓、入れない塔や壁、神社
- 地形：平地、山、川岸、寺、港、関所、海岸
- 特定の城用：大坂城、伏見城、江戸城、岐阜城、若松城、佐和山城、大垣城、姫路城、岡山城、熊本城、京都、堺
- 詳細地図用：街の中の町、布陣すすき野、布陣原、布陣山、布陣森、布陣町村、一般外町、街中砦用、町内寺、城門、街中屋敷
- 選択可否：選択用、選択不可

## その他

開始月：1604年4月

todo: [大坂冬御陣之図](https://bird.bukkyo-u.ac.jp/collections/titles/osakafuyunogojinzu/)(画像：[大坂冬御陣図 ： 1](https://dc.bukkyo-u.ac.jp/iiif/2/osakafuyunogojinzu-01-01.jp2/full/full/0/default.jpg))及び大名の領地地図を参考に大坂冬の陣まで時間を進め、1614年12月を開始月とする？